<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>åŒ—å®‹é™ªæˆ¿ä¸«é¬Ÿæ¨¡æ‹Ÿå™¨ - ç»ˆæç‰ˆ</title>
    <style>
        :root {
            --song-bg: #f5f1e9;
            --song-ink: #3a3530;
            --song-red: #b35c44; /* èŒœçº¢è‰² */
            --song-green: #6b8e85; /* è±†ç»¿ */
            --song-gold: #c5a367;
            --card-bg: #ffffff;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            margin: 0; padding: 0;
            background-color: var(--song-bg);
            color: var(--song-ink);
            font-family: "STSong", "SimSun", serif;
            display: flex; justify-content: center;
        }

        #mobile-container {
            width: 100vw; max-width: 500px;
            min-height: 100vh;
            padding: 15px;
            background: url('https://www.transparenttextures.com/patterns/natural-paper.png');
            position: relative;
        }

        /* é¡¶éƒ¨æ ‡é¢˜æ  */
        .header {
            text-align: center; border-bottom: 2px solid var(--song-ink);
            margin-bottom: 15px; padding-bottom: 5px;
        }
        .header h1 { margin: 0; font-size: 1.5rem; color: var(--song-red); }
        .header p { margin: 5px 0; font-size: 0.8rem; letter-spacing: 2px; }

        /* å¡ç‰‡å¸ƒå±€ */
        .card {
            background: var(--card-bg);
            border: 1px solid #dcd3c1;
            border-radius: 8px;
            margin-bottom: 15px;
            padding: 12px;
            box-shadow: 2px 2px 10px rgba(0,0,0,0.05);
            position: relative;
        }
        .card-title {
            font-size: 0.9rem; font-weight: bold;
            border-left: 3px solid var(--song-red);
            padding-left: 8px; margin-bottom: 10px;
            color: var(--song-ink);
        }

        /* å±æ€§ç½‘æ ¼ */
        .grid-info {
            display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px;
            font-size: 0.85rem;
        }
        .grid-item { background: #fdfaf5; padding: 6px; border-radius: 4px; border: 0.5px solid #eee; }

        /* æ—¥è®°æœ¬æ ·å¼ */
        .diary-box {
            background: #fffdf9; border: 1px dashed var(--song-gold);
            padding: 10px; font-size: 0.85rem; line-height: 1.6;
        }
        .diary-meta { border-bottom: 1px solid #eee; margin-bottom: 8px; display: flex; justify-content: space-between; font-size: 0.75rem; color: var(--song-red); }

        /* å…³ç³»ç½‘æ»šåŠ¨ */
        .npc-scroll { display: flex; overflow-x: auto; gap: 10px; padding-bottom: 10px; }
        .npc-mini-card {
            min-width: 130px; background: #f9f9f9; border-radius: 6px;
            padding: 8px; font-size: 0.75rem; border: 1px solid #eee;
        }

        /* åŠ¨æ€å±¥å† */
        .log-container {
            max-height: 120px; overflow-y: auto;
            background: #fdfcfb; padding: 8px; font-size: 0.8rem;
            border-radius: 4px; border: 1px inset #eee;
        }
        .log-line { margin-bottom: 4px; border-bottom: 1px solid #f0f0f0; padding-bottom: 2px; }

        /* æŒ‰é’®ç»„ */
        .footer-btns {
            position: sticky; bottom: 15px;
            display: grid; grid-template-columns: 1fr 1fr; gap: 10px;
        }
        button {
            background: var(--song-ink); color: #fff;
            border: none; padding: 12px; border-radius: 5px;
            font-weight: bold; font-family: "STSong";
        }
        button:active { background: var(--song-red); }

        /* ç‰¹æ®Šé«˜äº® */
        .highlight { color: var(--song-red); font-weight: bold; }
        .tag { font-size: 0.7rem; background: var(--song-green); color: white; padding: 1px 4px; border-radius: 3px; margin-right: 2px; }
        .period-tag { background: #d9534f; }

        /* æ¨¡æ€æ¡† */
        #modal-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7); z-index: 1000; justify-content: center; align-items: center;
        }
        .modal-body {
            background: white; width: 90%; max-height: 80%; border-radius: 10px;
            padding: 20px; overflow-y: auto; position: relative;
        }
    </style>
</head>
<body>

<div id="mobile-container">
    <div class="header">
        <h1>ã€åŒ—å®‹é™ªæˆ¿ä¸«é¬Ÿæ¨¡æ‹Ÿå™¨ã€‘</h1>
        <p>å°çº¢ä¹¦ï¼šäº‘æœµã®</p>
    </div>

    <div class="card">
        <div class="card-title">ğŸŒ¸ å‘½é€”æ¡£æ¡ˆ</div>
        <div id="status-grid" class="grid-info"></div>
        <div id="body-desc" style="margin-top:8px; font-size:0.8rem; color:#666; border-top:1px solid #eee; padding-top:5px;"></div>
    </div>

    <div class="card">
        <div class="card-title">ğŸ“œ éšèº«ç¬”è®°</div>
        <div class="diary-box">
            <div id="diary-meta" class="diary-meta"></div>
            <div id="diary-content"></div>
            <div id="diary-wish" style="margin-top:8px; border-top:1px dotted #ccc; font-size:0.75rem;"></div>
        </div>
    </div>

    <div class="card">
        <div class="card-title">ğŸ‘¥ å®…é—¨ç¾¤åƒ (å·¦å³æ»‘åŠ¨)</div>
        <div id="npc-list" class="npc-scroll"></div>
    </div>

    <div class="card">
        <div class="card-title">ğŸ® å®¶æ—åŸºä¸š</div>
        <div id="asset-info" class="grid-info"></div>
    </div>

    <div class="card">
        <div class="card-title">ğŸ“¢ æ±´äº¬é£é—»</div>
        <div id="event-log" class="log-container"></div>
    </div>

    <div class="footer-btns">
        <button onclick="advanceMonth()">ğŸ“… æ¨è¿›ä¸‹ä¸€æœˆ</button>
        <button onclick="showMenu()" style="background:var(--song-green);">ğŸ’¼ äº‹åŠ¡ç®¡ç†</button>
    </div>
</div>

<div id="modal-overlay" onclick="closeModal()">
    <div class="modal-body" onclick="event.stopPropagation()" id="modal-content"></div>
</div>

<script>
/**
 * æ ¸å¿ƒé€»è¾‘ä¸æ•°æ®
 */
const DATA = {
    time: { year: 1040, month: 3, season: "æ˜¥", cycleDay: 1 },
    player: {
        name: "æ‹›å„¿", realName: "æ²ˆæƒœè¾", age: 6, rank: "ç²—ä½¿ä¸«é¬Ÿ", salary: 300,
        money: 100, familySavings: 2000,
        attrs: { look: 70, mind: 65, sew: 10, read: 5, health: 90, charm: 50 },
        body: { height: 110, weight: 18, bust: "ç¨šæ°”", trait: "æ¢¨æ¶¡æµ…ç¬‘" },
        mood: "å®‰ç¨³", wish: "æ”’é’±ä¸ºæ¯äº²æ·»ä¸€åªé“¶é’—",
        period: { isBleeding: false, lastDate: 0 },
        preg: { isPreg: false, months: 0, cooldown: 0 },
        logs: []
    },
    house: {
        master: "ç››å®¶ (å¤ªåŸç‹æ°å‡ºèº«)",
        husband: "ç››å®˜äºº (äº”å“å‘˜å¤–éƒ)",
        location: "æ±´äº¬ç§¯å–„å··"
    },
    npcs: [],
    events: ["æ­£å€¼å®˜å®¶æ¨è¡Œåº†å†æ–°æ”¿ï¼Œå¸‚äº•é—´çº¸è´µã€‚"]
};

// é¢„è®¾NPC
const NPC_NAMES = [
    { name: "ç››é•¿æŸ", role: "å¤§å°‘çˆ·", age: 14, sex: "M", char: "ç«¯æ­£" },
    { name: "ç‹å¬·å¬·", role: "ç®¡äº‹", age: 45, sex: "F", char: "ä¸¥åˆ»" },
    { name: "ç¿ è‰", role: "å¤§ä¸«é¬Ÿ", age: 18, sex: "F", char: "æœºæ•" },
    { name: "æ—éƒä¸­", role: "åŒ»å®˜", age: 32, sex: "M", char: "æ¸©æ¶¦" }
];

// --- åˆå§‹åŒ– ---
function init() {
    DATA.npcs = NPC_NAMES.map((t, i) => ({
        ...t, id: i, favor: 10, backFavor: 10,
        attrs: { look: Math.floor(Math.random()*40+50) },
        outfit: "é’é”¦é•¿è¢ï¼Œç‰å† æŸå‘",
        thought: "è¯»ä¹¦å¿—åœ¨åœ£è´¤...",
        interactHistory: [],
        sexAbility: Math.floor(Math.random()*50+40)
    }));
    updateUI();
}

// --- æ¨è¿›ä¸‹ä¸€æœˆ ---
function advanceMonth() {
    // 1. æ—¶é—´å¢åŠ 
    DATA.time.month++;
    if(DATA.time.month > 12) {
        DATA.time.month = 1; DATA.time.year++; DATA.player.age++;
    }

    // 2. ç»æµ
    DATA.player.money += DATA.player.salary;
    DATA.player.familySavings += 500; // æ¨¡æ‹Ÿçˆ¶æ¯æ”¶å…¥

    // 3. ç”Ÿç†é€»è¾‘ (12å²ä»¥ä¸Šåˆæ½®)
    if(DATA.player.age >= 12) {
        DATA.player.period.isBleeding = Math.random() > 0.7; 
    }

    // 4. èŒä¸šæ™‹å‡åˆ¤å®š
    if(DATA.player.age == 10) careerPath();

    // 5. éšæœºNPCäº’åŠ¨ (æ»¡è¶³15æ¡)
    generateSocialLogs();

    // 6. éšæœºäº‹ä»¶
    const evs = [
        "æ±´äº¬é­é‡å€’æ˜¥å¯’ï¼Œç‚­ç«è´µäº†äº”æˆã€‚",
        "ä¸»æ¯èµèµäº†åºœä¸­ä¸«é¬Ÿæ¯äººä¸€åŠé’±ã€‚",
        "å¬é—»è¥¿å¤è¾¹å¢ƒåˆæœ‰æˆ˜äº‹ï¼Œå®˜äººé¢è‰²å¿§è™‘ã€‚"
    ];
    DATA.events.unshift(evs[Math.floor(Math.random()*evs.length)]);

    updateUI();
    checkSpecialEvents();
}

// --- NPCé€»è¾‘åŒæ­¥ ---
function generateSocialLogs() {
    for(let i=0; i<15; i++) {
        let n1 = DATA.npcs[Math.floor(Math.random()*DATA.npcs.length)];
        let n2 = DATA.npcs[Math.floor(Math.random()*DATA.npcs.length)];
        if(n1.id === n2.id) continue;

        const acts = ["ç§ä¸‹è®¨è®ºä»½ä¾‹é’±", "å› äº‰æŠ¢çƒ­æ°´èµ·äº†å£è§’", "å…±åŒåœ¨åèŠ±å›­èµèŠ±", "è®®è®ºå®˜å®¶æ–°å® "];
        let log = `${DATA.time.month}æœˆï¼š${n1.name}ä¸${n2.name}${acts[Math.floor(Math.random()*acts.length)]}ã€‚`;
        n1.interactHistory.unshift(log);
        n2.interactHistory.unshift(log);
        DATA.player.logs.unshift(log);
    }
}

// --- æˆ¿äº‹ä¸å­•è‚²é€»è¾‘ ---
function intimacyEvent(npcId) {
    let n = DATA.npcs[npcId];
    if(DATA.player.age < 16) {
        alert("å¹´å²å°šå°ï¼Œä¸å¯è¶ŠçŸ©ã€‚"); return;
    }
    if(DATA.player.period.isBleeding) {
        alert("æœˆäº‹åœ¨èº«ï¼Œä¸ä¾¿æ‰¿æ©ã€‚"); return;
    }

    let harmony = Math.floor(Math.random()*100);
    let desc = `ã€æˆ¿äº‹è®°å½•ã€‘ä½ ä¸${n.name}åŒæˆ¿ã€‚${n.name}åŠ¨ä½œ${harmony > 70 ? 'æ¸©æŸ”ä½“è´´' : 'ç•¥æ˜¾ç²—é²'}ï¼Œä¸¤äºº${harmony > 50 ? 'å¦‚é±¼å¾—æ°´' : 'å¿ƒæ„æ¸è¿œ'}ã€‚`;
    
    // æ€€å­•åˆ¤å®š (é¿å­•æœŸæ£€æŸ¥)
    if(!DATA.player.preg.isPreg && DATA.player.preg.cooldown <= 0) {
        let pregChance = (harmony + n.sexAbility) / 400; // åŸºç¡€æ¦‚ç‡
        if(Math.random() < pregChance) {
            DATA.player.preg.isPreg = true;
            DATA.player.preg.months = 1;
            desc += " äº‹åä½ è§‰èº«å­ç–²è½¯ï¼Œä¼¼æœ‰èƒå…†ã€‚";
        }
    }

    showModal(`<h3>é¸³é¸¯æˆæ°´</h3><p>${desc}</p>`);
    updateUI();
}

// --- èŒä¸šè€ƒæ ¸ ---
function careerPath() {
    let result = "äºŒç­‰ä¸«é¬Ÿ";
    if(DATA.player.attrs.sew > 30) result = "ç»£æˆ¿é¢†äº‹";
    if(DATA.player.attrs.read > 20) result = "ä¹¦æˆ¿éšä¾";
    DATA.player.rank = result;
    DATA.player.salary += 500;
    DATA.events.unshift(`ã€æ™‹å‡ã€‘åå²å¤§è€ƒï¼Œä½ å‡­æœ¬äº‹æˆäº†${result}ï¼`);
}

// --- æ¸²æŸ“ç•Œé¢ ---
function updateUI() {
    const p = DATA.player;
    // çŠ¶æ€
    document.getElementById('status-grid').innerHTML = `
        <div class="grid-item">ğŸ‘¤ å§“åï¼š${p.name}</div>
        <div class="grid-item">ç­‰çº§ï¼š${p.rank}</div>
        <div class="grid-item">å®¹è²Œï¼š${p.attrs.look}</div>
        <div class="grid-item">å¿ƒæ€§ï¼š${p.attrs.mind}</div>
        <div class="grid-item">å¥³çº¢ï¼š${p.attrs.sew}</div>
        <div class="grid-item">è¯†å­—ï¼š${p.attrs.read}</div>
    `;
    document.getElementById('body-desc').innerHTML = `
        <span class="tag">èº«æ</span> ${p.body.height}cm / ${p.body.weight}kg (${p.body.bust}) 
        <span class="tag" style="background:var(--song-gold)">ç‰¹ç‚¹</span> ${p.body.trait}
        ${p.period.isBleeding ? '<span class="tag period-tag">æœˆäº‹ä¸­</span>' : ''}
        ${p.preg.isPreg ? '<span class="tag" style="background:#f0ad4e">æ€€èƒ'+p.preg.months+'æœˆ</span>' : ''}
    `;

    // æ—¥è®°
    document.getElementById('diary-meta').innerHTML = `<span>${DATA.time.year}å¹´${DATA.time.month}æœˆ</span> <span>å¿ƒæƒ…ï¼š${p.mood}</span>`;
    document.getElementById('diary-content').innerText = `ä»Šæ—¥åœ¨${DATA.house.master}å†…åºœå¬å·®ï¼Œ${p.rank}çš„æ´»è®¡è™½ç´¯ï¼Œä½†ç§ç€æ”’ä¸‹çš„é“¶é’±ï¼Œå¿ƒé‡Œä¹Ÿè¸å®äº›ã€‚`;
    document.getElementById('diary-wish').innerHTML = `<span class="highlight">æ„¿æœ›ï¼š</span> ${p.wish}`;

    // NPC
    document.getElementById('npc-list').innerHTML = DATA.npcs.map(n => `
        <div class="npc-mini-card" onclick="viewNpc(${n.id})">
            <b>${n.name}</b> (${n.role})<br>
            å¥½æ„Ÿï¼š${n.favor} | å›é¦ˆï¼š${n.backFavor}<br>
            <small style="color:#999">${n.outfit}</small>
        </div>
    `).join('');

    // èµ„äº§
    document.getElementById('asset-info').innerHTML = `
        <div class="grid-item">ğŸ’° ç§æˆ¿é’±ï¼š<span class="highlight">${p.money}æ–‡</span></div>
        <div class="grid-item">ğŸ  å®¶æ—ï¼š${p.familySavings}æ–‡</div>
    `;

    // å±¥å†
    document.getElementById('event-log').innerHTML = DATA.player.logs.slice(0, 20).map(l => `<div class="log-line">${l}</div>`).join('');
}

// --- äº¤äº’è¾…åŠ© ---
function showModal(html) {
    document.getElementById('modal-content').innerHTML = html;
    document.getElementById('modal-overlay').style.display = 'flex';
}
function closeModal() { document.getElementById('modal-overlay').style.display = 'none'; }

function viewNpc(id) {
    let n = DATA.npcs[id];
    let html = `
        <h3>${n.name} æ¡£æ¡ˆ</h3>
        <p><b>å®¹è²Œï¼š</b>${n.attrs.look} | <b>æ€§æ ¼ï¼š</b>${n.char}</p>
        <p><b>è¡£ç€ï¼š</b>${n.outfit}</p>
        <p><b>å¿ƒå¢ƒï¼š</b>"${n.thought}"</p>
        <hr>
        <button onclick="intimacyEvent(${id})">ğŸ’ äº²å¯†åŒæˆ¿</button>
        <h4 style="margin-top:15px">è¿‘æ—¥åŠ¨å‘</h4>
        <div style="font-size:0.8rem; color:#666">${n.interactHistory.slice(0,5).join("<br>")}</div>
    `;
    showModal(html);
}

function showMenu() {
    let html = `
        <h3>ğŸ’¼ åºœå†…äº‹åŠ¡</h3>
        <button style="width:100%; margin-bottom:10px;" onclick="doTask('sew')">ç ”ä¹ å¥³çº¢ (+æŠ€èƒ½)</button>
        <button style="width:100%; margin-bottom:10px;" onclick="doTask('read')">å·ç¿»ä¹¦å· (+è¯†å­—)</button>
        <button style="width:100%; margin-bottom:10px;" onclick="alert('é»‘å¸‚å°šæœªå¼€å¯ï¼Œéœ€ç­‰ä¸Šå…ƒèŠ‚ã€‚')">è§’é—¨é»‘å¸‚</button>
    `;
    showModal(html);
}

function doTask(type) {
    if(type=='sew') DATA.player.attrs.sew += 2;
    if(type=='read') DATA.player.attrs.read += 2;
    DATA.player.money += 10;
    alert("å‹¤å‹¤æ³æ³åšäº†ä¸€æœˆæ´»è®¡ï¼ŒæŠ€èƒ½æœ‰æ‰€é•¿è¿›ï¼Œè·èµ10æ–‡ã€‚");
    closeModal();
    updateUI();
}

function checkSpecialEvents() {
    // ç®€å•çš„ç”Ÿè‚²é€»è¾‘ï¼šæ»¡10ä¸ªæœˆåˆ†å¨©
    if(DATA.player.preg.isPreg) {
        DATA.player.preg.months++;
        if(DATA.player.preg.months > 10) {
            DATA.player.preg.isPreg = false;
            DATA.player.preg.months = 0;
            DATA.player.preg.cooldown = 36; // é¿å­•3å¹´
            let dieRoll = Math.random();
            if(dieRoll < 0.05) alert("ä¸å¹¸é­é‡éš¾äº§ï¼Œæ‰€å¹¸å¤§äººä¿ä½äº†ã€‚");
            else alert("å¤©ä½‘æ¯å­ï¼é¡ºäº§å¾—ä¸€éºŸå„¿ï¼Œå·²è®°å…¥æ—è°±ã€‚");
        }
    }
    if(DATA.player.preg.cooldown > 0) DATA.player.preg.cooldown--;
}

init();
</script>
</body>
</html>
