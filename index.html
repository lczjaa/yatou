<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>åŒ—å®‹é™ªæˆ¿ä¸«é¬Ÿæ¨¡æ‹Ÿå™¨</title>
    <style>
        :root {
            --bg-color: #fdf6ec;
            --card-bg: #ffffff;
            --primary-pink: #f4cfdf;
            --accent-green: #b8d8be;
            --text-dark: #5d5246;
            --border-gold: #d4b185;
            --shadow: 0 4px 10px rgba(0,0,0,0.05);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            font-family: "PingFang SC", "Microsoft YaHei", serif;
            color: var(--text-dark);
            line-height: 1.5;
            display: flex;
            justify-content: center;
        }

        /* æ‰‹æœºå®¹å™¨é™åˆ¶ */
        #game-container {
            width: 100vw;
            max-width: 480px;
            min-height: 100vh;
            background: var(--bg-color);
            padding: 15px;
            position: relative;
            overflow-x: hidden;
            border-left: 1px solid #eee;
            border-right: 1px solid #eee;
        }

        /* é¡¶éƒ¨æ ‡é¢˜ */
        .header {
            text-align: center;
            margin-bottom: 15px;
            padding: 10px;
            border-bottom: 2px double var(--border-gold);
        }
        .header h1 { margin: 0; font-size: 1.4rem; color: #a67c52; }
        .header p { margin: 5px 0 0; font-size: 0.85rem; color: #888; }

        /* é€šç”¨å¡ç‰‡æ ·å¼ */
        .card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid var(--primary-pink);
            box-shadow: var(--shadow);
            position: relative;
        }

        .card-title {
            font-weight: bold;
            color: #c09060;
            border-left: 4px solid var(--primary-pink);
            padding-left: 8px;
            margin-bottom: 10px;
            font-size: 1rem;
        }

        /* çŠ¶æ€å±æ€§æ  */
        .status-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            font-size: 0.9rem;
        }
        .status-item {
            background: #fffafa;
            padding: 5px 8px;
            border-radius: 6px;
        }

        /* æ—¥è®°æ ·å¼ */
        .diary-box {
            background: #fffdf9;
            border: 1px dashed var(--border-gold);
            padding: 12px;
            font-style: italic;
            font-size: 0.9rem;
        }
        .diary-meta {
            display: flex;
            justify-content: space-between;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
            margin-bottom: 8px;
            font-size: 0.8rem;
            color: #a67c52;
        }

        /* NPCå±•ç¤ºåŒº */
        .npc-scroll {
            display: flex;
            overflow-x: auto;
            gap: 10px;
            padding-bottom: 5px;
        }
        .npc-mini-card {
            min-width: 140px;
            background: #fdfcfb;
            border: 1px solid #eee;
            padding: 8px;
            border-radius: 8px;
            font-size: 0.8rem;
        }

        /* æ—¥å¸¸å±¥å† */
        .log-box {
            max-height: 150px;
            overflow-y: auto;
            font-size: 0.85rem;
            background: #f9f9f9;
            padding: 8px;
            border-radius: 5px;
        }
        .log-item { margin-bottom: 4px; border-bottom: 1px solid #efefef; }

        /* æŒ‰é’®åŒº */
        .btn-group {
            position: sticky;
            bottom: 0;
            background: var(--bg-color);
            padding: 10px 0;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        button {
            padding: 12px;
            border: none;
            border-radius: 25px;
            background: linear-gradient(135deg, #f4cfdf 0%, #d4b185 100%);
            color: white;
            font-weight: bold;
            font-size: 1rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        button:active { transform: scale(0.98); }

        /* è§†è§‰å¼ºè°ƒ */
        .highlight { color: #d9534f; font-weight: bold; }
        .money { color: #b8860b; font-weight: bold; }
        .tag {
            display: inline-block;
            background: var(--accent-green);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.7rem;
            margin-right: 4px;
        }

        /* æ¨¡æ€æ¡† */
        #modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 100;
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background: white;
            width: 85%;
            max-height: 70%;
            border-radius: 15px;
            padding: 20px;
            overflow-y: auto;
        }
    </style>
</head>
<body>

<div id="game-container">
    <div class="header">
        <h1>ã€åŒ—å®‹é™ªæˆ¿ä¸«é¬Ÿæ¨¡æ‹Ÿå™¨ã€‘</h1>
        <p>å°çº¢ä¹¦ï¼šäº‘æœµã® | æ±´äº¬ä¸–ç¦„Â·é™ªæˆ¿ä¼ å¥‡</p>
    </div>

    <div id="player-card" class="card">
        <div class="card-title">ğŸŒ¸ ä¸ªäººçŠ¶æ€</div>
        <div id="player-basic" class="status-grid">
            </div>
    </div>

    <div id="diary-card" class="card">
        <div class="card-title">ğŸ“œ éšèº«ç¬”è®° (æ—¥è®°)</div>
        <div class="diary-box">
            <div id="diary-meta" class="diary-meta"></div>
            <div id="diary-content"></div>
            <hr style="border:0; border-top:1px dotted #ccc;">
            <div id="diary-tasks" style="font-size: 0.8rem; color: #666;"></div>
        </div>
    </div>

    <div id="env-card" class="card">
        <div class="card-title">ğŸ¡ æ‰€åœ¨åºœé‚¸ä¸å®¶æ—</div>
        <div id="env-info" style="font-size: 0.9rem;"></div>
    </div>

    <div id="npc-card" class="card">
        <div class="card-title">ğŸ‘¥ åºœä¸­ä¼—äºº (ç‚¹å‡»æŸ¥çœ‹çº è‘›)</div>
        <div id="npc-list" class="npc-scroll"></div>
    </div>

    <div id="log-card" class="card">
        <div class="card-title">ğŸ“¢ æ±´äº¬é£é—»/åºœä¸­å±¥å†</div>
        <div id="event-logs" class="log-box"></div>
    </div>

    <div class="btn-group">
        <button onclick="nextMonth()">æ¨è¿›ä¸‹ä¸€æœˆ</button>
        <button onclick="viewAssets()" style="background: linear-gradient(135deg, #b8d8be 0%, #88b091 100%);">æŸ¥çœ‹èµ„äº§ä¸€è§ˆ</button>
    </div>
</div>

<div id="modal" onclick="closeModal()">
    <div class="modal-content" onclick="event.stopPropagation()" id="modal-body"></div>
</div>

<script>
    // --- æ¸¸æˆæ ¸å¿ƒæ•°æ® ---
    let state = {
        time: { year: 1040, month: 3, season: "æ˜¥", day: 1, week: "ä¸€" },
        player: {
            name: "å°çº¢",
            realName: "æ—å©‰å„¿",
            age: 6,
            level: "ç²—ä½¿ä¸«é¬Ÿ",
            salary: 600,
            money: 100, // ç§æˆ¿é’±
            attrs: { appearance: 70, heart: 80, health: 90, moral: 85, skill_sew: 5, skill_read: 0, skill_acc: 0 },
            body: { height: "115cm", weight: "20kg", chest: "å¹³", comment: "èº«å­å°šæœªé•¿å¼€ï¼Œç•¥æ˜¾æ¶ˆç˜¦ã€‚" },
            tags: ["ç»†å¿ƒ", "å‹¤å¥‹", "çµå·§"],
            mood: "å¹³é™",
            pregnant: null,
            period: false
        },
        family: {
            assets: 2000,
            house: "å¤§æ‚é™¢è€³æˆ¿",
            transport: "æ­¥è¡Œ",
            members: []
        },
        master: {
            houseName: "ç››åºœ",
            lady: "ç‹æ° (å‡ºèº«å¤ªåŸç‹æ°)",
            husband: "ç››å®˜äºº (äº”å“å·¥éƒ¨å‘˜å¤–éƒ)"
        },
        npcs: [],
        logs: []
    };

    const NAMES = ["æ˜¥æ¡ƒ", "ç¿ ç¼•", "é‡‘é’", "å½©äº‘", "å¢¨ç«¹", "é›ªé›", "å å„¿"];
    const WEATHERS = ["æ™´ç©ºä¸‡é‡Œ", "å¾®é›¨éœéœ", "æ˜¥å¯’æ–™å³­", "é˜´é›¨ç»µç»µ", "ç‡¥çƒ­éš¾å½“"];
    const MOODS = ["å–œæ‚¦", "å¿§æ€", "å¿å¿‘", "ç–²æƒ«", "æ»¡æ€€å¸Œæœ›"];

    // --- åˆå§‹åŒ–å‡½æ•° ---
    function initGame() {
        generateFamily();
        generateNPCs(8);
        updateUI();
    }

    function generateFamily() {
        state.family.members = [
            { role: "çˆ¶", job: "é©¬å¤«", salary: 800 },
            { role: "æ¯", job: "å¨æˆ¿å¸®å·¥", salary: 500 }
        ];
    }

    function generateNPCs(count) {
        for (let i = 0; i < count; i++) {
            let npc = {
                id: i,
                name: NAMES[Math.floor(Math.random() * NAMES.length)] + i,
                age: 10 + Math.floor(Math.random() * 20),
                appearance: Math.floor(Math.random() * 100),
                heart: Math.floor(Math.random() * 100),
                relation: Math.floor(Math.random() * 40 + 30),
                outfit: "é’è‰²éº»å¸ƒé•¿è£™ï¼Œå¤´ç°ªæœ¨é’—",
                mind: "ä»Šæ—¥çš„å·®äº‹åƒä¸‡åˆ«å‡ºå·®é”™...",
                logs: []
            };
            state.npcs.push(npc);
        }
    }

    // --- é€»è¾‘æ¨è¿› ---
    function nextMonth() {
        // 1. æ—¶é—´æ¨è¿›
        state.time.month++;
        if (state.time.month > 12) {
            state.time.month = 1;
            state.time.year++;
            state.player.age++;
        }

        // 2. è´¢åŠ¡ç»“ç®—
        state.player.money += state.player.salary;
        let familyIncome = state.family.members.reduce((sum, m) => sum + m.salary, 0);
        state.family.assets += familyIncome;

        // 3. éšæœºäº‹ä»¶
        triggerRandomEvent();

        // 4. NPCäº’åŠ¨ (ç”Ÿæˆ15æ¡é€»è¾‘å±¥å†)
        generateDailyLogs();

        updateUI();
        showModal(`<h3>ğŸ“… å²æœˆæµè½¬</h3><p>å·²è¿›å…¥ <b>${state.time.year}å¹´ ${state.time.month}æœˆ</b>ã€‚<br>æœ¬æœˆæœˆé’± <span class="money">${state.player.salary}æ–‡</span> å·²å‘æ”¾è‡³ç§æˆ¿é’±ã€‚</p>`);
    }

    function triggerRandomEvent() {
        const events = [
            { text: "åœ¨è§’é—¨æ¡åˆ°ä¸€æšé“œé’±ã€‚", effect: () => state.player.money += 1 },
            { text: "å› æ´’æ‰«å‹¤å¿«ï¼Œç®¡äº‹å¬·å¬·èµäº†20æ–‡ã€‚", effect: () => state.player.money += 20 },
            { text: "ä¸å°å¿ƒæ‰“ç¢äº†ä¸€ä¸ªç²—ç“·ç¢—ï¼Œè¢«æ‰£æœˆé’±10æ–‡ã€‚", effect: () => state.player.money -= 10 }
        ];
        let ev = events[Math.floor(Math.random() * events.length)];
        ev.effect();
        state.logs.unshift(`ã€äº‹ä»¶ã€‘${ev.text}`);
    }

    function generateDailyLogs() {
        for (let i = 0; i < 15; i++) {
            let n1 = state.npcs[Math.floor(Math.random() * state.npcs.length)];
            let n2 = state.npcs[Math.floor(Math.random() * state.npcs.length)];
            if (n1.id === n2.id) continue;

            let actions = ["ç§ä¸‹è®®è®ºå…‹æ‰£æœˆé’±", "ä¸€èµ·åœ¨åé™¢ç»£èŠ±", "å› äº‰æŠ¢çƒ­æ°´èµ·äº†å£è§’", "åˆ†äº«äº†åŠå—æ¢…èŠ±ç³•"];
            let act = actions[Math.floor(Math.random() * actions.length)];
            let logStr = `${state.time.month}æœˆ${Math.floor(Math.random() * 28 + 1)}æ—¥ï¼š${n1.name} ä¸ ${n2.name} ${act}ã€‚`;
            
            n1.logs.push(logStr);
            n2.logs.push(logStr);
            state.logs.unshift(logStr);
        }
    }

    // --- UIæ¸²æŸ“ ---
    function updateUI() {
        // 1. ç©å®¶åŸºæœ¬ä¿¡æ¯
        const p = state.player;
        document.getElementById('player-basic').innerHTML = `
            <div class="status-item">ğŸ‘¤ å§“åï¼š${p.name} (${p.realName})</div>
            <div class="status-item">ğŸ‚ å¹´é¾„ï¼š${p.age} å²</div>
            <div class="status-item">ğŸ† ç­‰çº§ï¼š<span class="highlight">${p.level}</span></div>
            <div class="status-item">ğŸ’° ç§æˆ¿ï¼š<span class="money">${p.money}æ–‡</span></div>
            <div class="status-item">ğŸ‘— å®¹è²Œï¼š${p.attrs.appearance}</div>
            <div class="status-item">ğŸ’– å¿ƒæ€§ï¼š${p.attrs.heart}</div>
            <div class="status-item">ğŸ§¶ å¥³çº¢ï¼š${p.attrs.skill_sew}</div>
            <div class="status-item">ğŸ’ª ä½“é­„ï¼š${p.attrs.health}</div>
        `;

        // 2. æ—¥è®°
        document.getElementById('diary-meta').innerHTML = `
            <span>ğŸ“… ${state.time.year}å¹´${state.time.month}æœˆ</span>
            <span>â˜ï¸ ${WEATHERS[Math.floor(Math.random()*WEATHERS.length)]}</span>
            <span>ğŸ­ å¿ƒæƒ…ï¼š${MOODS[Math.floor(Math.random()*MOODS.length)]}</span>
        `;
        document.getElementById('diary-content').innerText = `ä»Šæ—¥åœ¨${state.master.houseName}å½“å·®ï¼Œ${state.player.level}çš„å·¥ä½œä¾æ—§ç¹é‡ã€‚å¬${state.npcs[0].name}è¯´ï¼Œæ±´äº¬åŸçš„çŸ¾æ¥¼æœ€è¿‘åˆå‡ºæ–°è¯äº†...`;
        document.getElementById('diary-tasks').innerHTML = `<b>ä»Šæ—¥ä»»åŠ¡ï¼š</b> æ´’æ‰«åº­é™¢(å®Œæˆâˆš) | æµ†æ´—è¡£æœ(å®Œæˆâˆš)`;

        // 3. åºœé‚¸ä¿¡æ¯
        document.getElementById('env-info').innerHTML = `
            ğŸ“ <b>${state.master.houseName}</b><br>
            ä¸»æ¯ï¼š${state.master.lady}<br>
            ä¸»å…¬ï¼š${state.master.husband}<br>
            <span class="tag">å®¶ç”Ÿå­</span> <span class="tag">é˜¶çº§ï¼šä»†å½¹</span>
        `;

        // 4. NPC åˆ—è¡¨
        let npcHtml = "";
        state.npcs.forEach(n => {
            npcHtml += `
                <div class="npc-mini-card" onclick="viewNpc(${n.id})">
                    <b>${n.name}</b> (${n.age}å²)<br>
                    å¥½æ„Ÿï¼š${n.relation}<br>
                    <small>${n.outfit}</small>
                </div>
            `;
        });
        document.getElementById('npc-list').innerHTML = npcHtml;

        // 5. æ—¥å¸¸å±¥å†
        document.getElementById('event-logs').innerHTML = state.logs.slice(0, 30).map(l => `<div class="log-item">${l}</div>`).join("");
    }

    // --- å¼¹çª—åŠŸèƒ½ ---
    function showModal(content) {
        document.getElementById('modal-body').innerHTML = content;
        document.getElementById('modal').style.display = 'flex';
    }

    function closeModal() {
        document.getElementById('modal').style.display = 'none';
    }

    function viewNpc(id) {
        let n = state.npcs[id];
        let content = `
            <h3>${n.name} çš„æ¡£æ¡ˆ</h3>
            <p><b>å®¹è²Œï¼š</b> ${n.appearance} | <b>å¿ƒæ€§ï¼š</b> ${n.heart}</p>
            <p><b>ç©¿æ­ï¼š</b> ${n.outfit}</p>
            <p><b>å¿ƒç†ï¼š</b> <span style="color:#888">"${n.mind}"</span></p>
            <hr>
            <h4>äº’åŠ¨å¾€äº‹</h4>
            <div style="font-size:0.8rem">${n.logs.slice(-5).join("<br>") || "æš‚æ— é‡è¦çº è‘›"}</div>
        `;
        showModal(content);
    }

    function viewAssets() {
        let p = state.player;
        let content = `
            <h3>ğŸ® å®¶æ—èµ„äº§ä¸€è§ˆ</h3>
            <p><b>å®¶æ—æ€»èµ„äº§ï¼š</b> <span class="money">${state.family.assets}æ–‡</span></p>
            <p><b>ç°å±…ç¯å¢ƒï¼š</b> ${state.family.house}</p>
            <p><b>ä»£æ­¥å·¥å…·ï¼š</b> ${state.family.transport}</p>
            <hr>
            <h4>ç§æˆ¿é’±æ˜ç»†</h4>
            <p><b>ä¸ªäººç§¯è“„ï¼š</b> ${p.money}æ–‡</p>
            <p><b>å½“å‰æœˆé’±ï¼š</b> ${p.salary}æ–‡/æœˆ</p>
            <button onclick="closeModal()" style="width:100%; margin-top:10px;">è¿”å›</button>
        `;
        showModal(content);
    }

    // å¯åŠ¨
    initGame();
</script>

</body>
</html>
